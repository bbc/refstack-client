refstack-client
===============

refstack-client is a command line utility that allows you to execute Tempest
test runs based on configurations you specify.  When finished running Tempest
it sends the passed test data back to the Refstack API server.

**Environment setup**

We've created an "easy button" for Ubuntu, Centos, RHEL and openSuSe.

1. Make sure you have *git* installed
2. Get the refstack client: `git clone https://github.com/stackforge/refstack-client`
3. Go into the refstack-client directory: `cd refstack-client`
4. Run the "easy button" setup: `./setup_env`

   **Options:**

   a. -t option allows to specify tag in Tempest repository which will be
   installed. By default, Tempest from last tag release will be used.

**Usage**

1. Prepare a tempest configuration file that is customized to your cloud
   environment.
2. Go into the refstack-client directory.

   `cd ~/refstack-client`

3. Source to use the correct Python environment.

   `source .venv/bin/activate`

4. Validate your setup by running a short test.

   `./refstack-client test -c <Path of the tempest configuration file to use>`
                   `-vv -t "tempest.api.identity.admin.test_roles"`

5. Run a full API test set.

   `./refstack-client test -c <Path of the tempest configuration file to use> -vv`
 
   **Note:**

   a. Adding -v option will show the summary output.
   b. Adding -vv option will show the Tempest test result output.
   c. Adding -t option will only test a particular test case or a test group.
      This option can be used for quick verification of the target test cases
      (i.e. -t "tempest.api.identity.admin.test_roles").
   d. Adding --upload option will have your test results be uploaded to the
      default Refstack API server or the server specified by --url.
   e. Adding --url option will allow you to change where test results should
      be uploaded.
   f. Adding -r option with a string will prefix the JSON result file with the
      given string (e.g. '-r my-test' will yield a result file like
      'my-test-0.json').

   **Upload:**

   If you previously ran a test with refstack-client without the --upload
   option, you can upload your results to a Refstack API server by using the
   following command:

   ./refstack-client upload <Path of results file>

   The results file is a JSON file generated by refstack-client when a test has
   completed. This is saved in .tempest/.testrepository. When you use the
   'upload' command, you can also override the Refstack API server uploaded to
   with the --url option.

**Tempest Hacking**

By default, refstack-client installs Tempest into the `.tempest` directory.
If you're interested in working with Tempest directly for debugging or
configuration, you can activate a working Tempest environment by
switching to that directory and using the installed dependencies.

1. `cd .tempest`
2. run tempest with `./run_tempest.sh -V ` or `source ./.venv/bin/activate`
   and run tests manually with `testr`.

This will make the entire Tempest environment available for you to run,
including the `run_tempest` script and `testr`.


